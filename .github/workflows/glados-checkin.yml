name: GLaDOS 多账号自动签到

on:
  schedule:
    # 北京时间 8:00、12:00、20:00 各触发一次
    - cron: '0 0 * * *'   # UTC 0:00 = 北京 8:00
    # - cron: '0 4 * * *'   # UTC 4:00 = 北京 12:00
    # - cron: '0 12 * * *'  # UTC 12:00 = 北京 20:00
  workflow_dispatch: # 允许手动触发

jobs:
  checkin:
    runs-on: ubuntu-latest
    
    steps:
    - name: 检出代码
      uses: actions/checkout@v4

    - name: 执行多账号签到
      env:
        BARK_URL: ${{ secrets.BARK_URL }}
        BARK_KEY: ${{ secrets.BARK_KEY }}
        # 多账号配置 - 支持最多5个账号
        ACCOUNT1_COOKIE: ${{ secrets.ACCOUNT1_COOKIE }}
        ACCOUNT1_NAME: ${{ secrets.ACCOUNT1_NAME }}
        ACCOUNT2_COOKIE: ${{ secrets.ACCOUNT2_COOKIE }}
        ACCOUNT2_NAME: ${{ secrets.ACCOUNT2_NAME }}
        ACCOUNT3_COOKIE: ${{ secrets.ACCOUNT3_COOKIE }}
        ACCOUNT3_NAME: ${{ secrets.ACCOUNT3_NAME }}
        ACCOUNT4_COOKIE: ${{ secrets.ACCOUNT4_COOKIE }}
        ACCOUNT4_NAME: ${{ secrets.ACCOUNT4_NAME }}
        ACCOUNT5_COOKIE: ${{ secrets.ACCOUNT5_COOKIE }}
        ACCOUNT5_NAME: ${{ secrets.ACCOUNT5_NAME }}
      run: |
        chmod +x ./scripts/glados-checkin.sh
        ./scripts/glados-checkin.sh
        
    - name: 上传签到日志
      uses: actions/upload-artifact@v4
      if: always()
      with:
        name: checkin-logs-${{ github.run_number }}
        path: |
          api.log
          sign.log
          multi-account.log
